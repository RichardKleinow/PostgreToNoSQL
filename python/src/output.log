2022-11-07 16:39:01,143 [MainProcess] [root] [INFO] PostgresVersion: ('PostgreSQL 15.0 (Debian 15.0-1.pgdg110+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 10.2.1-6) 10.2.1 20210110, 64-bit',)
2022-11-07 16:39:01,147 [MainProcess] [root] [INFO] 15 tables found in database
2022-11-07 16:39:01,176 [MainProcess] [root] [INFO] Mongo-DB Server version: 6.0.2
2022-11-07 16:39:01,436 [MainProcess] [root] [INFO] Transformation of 15 tables successful
2022-11-07 16:39:01,436 [MainProcess] [root] [INFO] ######### CREATE START ############################
2022-11-07 16:39:01,436 [MainProcess] [root] [INFO] Starting to insert 15 json elements into new database.
2022-11-07 16:39:01,436 [MainProcess] [root] [INFO] Command used to insert: collection.insert_many(dicttables.get(table))
2022-11-07 16:39:02,380 [MainProcess] [root] [INFO] 15 tables were successfully inserted as collections.
2022-11-07 16:39:02,380 [MainProcess] [root] [INFO] ######### READ START ############################
2022-11-07 16:39:02,380 [MainProcess] [root] [INFO] --------Number of available films--------
2022-11-07 16:39:02,380 [MainProcess] [root] [INFO] Pipeline used: [{'$count': 'film'}]
2022-11-07 16:39:02,380 [MainProcess] [root] [INFO] Pipeline used on Collection: film
2022-11-07 16:39:02,383 [MainProcess] [root] [INFO] Aggregation returned:
2022-11-07 16:39:02,383 [MainProcess] [root] [INFO] {'film': 1000}
2022-11-07 16:39:02,384 [MainProcess] [root] [INFO] 
2022-11-07 16:39:02,384 [MainProcess] [root] [INFO] --------Number of films per location--------
2022-11-07 16:39:02,384 [MainProcess] [root] [INFO] Pipeline used: [{'$group': {'_id': '$store_id', 'count': {'$sum': 1}}}, {'$project': {'_id': 0, 'store_id': '$_id', 'count': 1}}]
2022-11-07 16:39:02,384 [MainProcess] [root] [INFO] Pipeline used on Collection: inventory
2022-11-07 16:39:02,389 [MainProcess] [root] [INFO] Aggregation returned:
2022-11-07 16:39:02,389 [MainProcess] [root] [INFO] {'count': 2270, 'store_id': 1}
2022-11-07 16:39:02,389 [MainProcess] [root] [INFO] {'count': 2311, 'store_id': 2}
2022-11-07 16:39:02,389 [MainProcess] [root] [INFO] 
2022-11-07 16:39:02,389 [MainProcess] [root] [INFO] --------Full name, 10 most used actors, sorted ascending --------
2022-11-07 16:39:02,389 [MainProcess] [root] [INFO] Pipeline used: [{'$group': {'_id': '$actor_id', 'count': {'$sum': 1}, 'actor_id': {'$first': '$actor_id'}}}, {'$sort': {'count': -1}}, {'$limit': 10}, {'$lookup': {'from': 'actor', 'localField': 'actor_id', 'foreignField': 'actor_id', 'as': 'actor'}}, {'$unwind': {'path': '$actor', 'preserveNullAndEmptyArrays': True}}, {'$addFields': {'fullName': {'$concat': ['$actor.first_name', ' ', '$actor.last_name']}}}, {'$project': {'_id': 0, 'name': '$fullName', 'count': '$count'}}]
2022-11-07 16:39:02,389 [MainProcess] [root] [INFO] Pipeline used on Collection: film_actor
2022-11-07 16:39:02,397 [MainProcess] [root] [INFO] Aggregation returned:
2022-11-07 16:39:02,397 [MainProcess] [root] [INFO] {'name': 'Gina Degeneres', 'count': 42}
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] {'name': 'Walter Torn', 'count': 41}
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] {'name': 'Mary Keitel', 'count': 40}
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] {'name': 'Matthew Carrey', 'count': 39}
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] {'name': 'Sandra Kilmer', 'count': 37}
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] {'name': 'Scarlett Damon', 'count': 36}
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] {'name': 'Uma Wood', 'count': 35}
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] {'name': 'Henry Berry', 'count': 35}
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] {'name': 'Groucho Dunst', 'count': 35}
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] {'name': 'Val Bolger', 'count': 35}
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] 
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] --------Revenue per Employees --------
2022-11-07 16:39:02,398 [MainProcess] [root] [INFO] Pipeline used: [{'$group': {'_id': '$staff_id', 'count': {'$sum': '$amount'}, 'staff_id': {'$first': '$staff_id'}}}, {'$lookup': {'from': 'staff', 'localField': 'staff_id', 'foreignField': 'staff_id', 'as': 'staff'}}, {'$unwind': {'path': '$staff', 'preserveNullAndEmptyArrays': True}}, {'$addFields': {'fullName': {'$concat': ['$staff.first_name', ' ', '$staff.last_name']}}}, {'$project': {'_id': 0, 'name': '$fullName', 'revenue': {'$round': ['$count', 2]}, 'staff_id': 1}}]
2022-11-07 16:39:02,399 [MainProcess] [root] [INFO] Pipeline used on Collection: payment
2022-11-07 16:39:02,412 [MainProcess] [root] [INFO] Aggregation returned:
2022-11-07 16:39:02,412 [MainProcess] [root] [INFO] {'staff_id': 2, 'name': 'Jon Stephens', 'revenue': 31059.92}
2022-11-07 16:39:02,412 [MainProcess] [root] [INFO] {'staff_id': 1, 'name': 'Mike Hillyer', 'revenue': 30252.12}
2022-11-07 16:39:02,412 [MainProcess] [root] [INFO] 
2022-11-07 16:39:02,412 [MainProcess] [root] [INFO] --------customer IDs, 10 most rentals --------
2022-11-07 16:39:02,412 [MainProcess] [root] [INFO] Pipeline used: [{'$group': {'_id': '$customer_id', 'count': {'$sum': 1}, 'customer_id': {'$first': '$customer_id'}}}, {'$sort': {'count': -1}}, {'$limit': 10}, {'$project': {'_id': 0, 'customer_id': 1, 'count': '$count'}}]
2022-11-07 16:39:02,412 [MainProcess] [root] [INFO] Pipeline used on Collection: rental
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] Aggregation returned:
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] {'customer_id': 148, 'count': 46}
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] {'customer_id': 526, 'count': 45}
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] {'customer_id': 236, 'count': 42}
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] {'customer_id': 144, 'count': 42}
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] {'customer_id': 75, 'count': 41}
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] {'customer_id': 197, 'count': 40}
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] {'customer_id': 469, 'count': 40}
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] {'customer_id': 468, 'count': 39}
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] {'customer_id': 137, 'count': 39}
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] {'customer_id': 178, 'count': 39}
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] 
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] --------Fullname, office location, 10 customer, most money spend--------
2022-11-07 16:39:02,428 [MainProcess] [root] [INFO] Pipeline used: [{'$group': {'_id': '$customer_id', 'count': {'$sum': '$amount'}, 'customer_id': {'$first': '$customer_id'}}}, {'$sort': {'count': -1}}, {'$limit': 10}, {'$lookup': {'from': 'customer', 'localField': 'customer_id', 'foreignField': 'customer_id', 'as': 'customer'}}, {'$unwind': {'path': '$customer', 'preserveNullAndEmptyArrays': True}}, {'$lookup': {'from': 'customer', 'localField': 'customer_id', 'foreignField': 'customer_id', 'as': 'customer'}}, {'$unwind': {'path': '$customer', 'preserveNullAndEmptyArrays': True}}, {'$lookup': {'from': 'store', 'localField': 'customer.store_id', 'foreignField': 'store_id', 'as': 'store'}}, {'$unwind': {'path': '$store', 'preserveNullAndEmptyArrays': True}}, {'$lookup': {'from': 'address', 'localField': 'store.address_id', 'foreignField': 'address_id', 'as': 'address'}}, {'$unwind': {'path': '$address', 'preserveNullAndEmptyArrays': True}}, {'$lookup': {'from': 'city', 'localField': 'address.city_id', 'foreignField': 'city_id', 'as': 'city'}}, {'$unwind': {'path': '$city', 'preserveNullAndEmptyArrays': True}}, {'$addFields': {'fullName': {'$concat': ['$customer.first_name', ' ', '$customer.last_name']}, 'officeLocation': {'$concat': [{'$cond': {'if': {'$eq': ['$address.address', '']}, 'then': '$address.address', 'else': '$address.address2'}}, ' ,', '$address.postal_code', ' ', '$city.city']}}}, {'$project': {'_id': 0, 'Full Name': '$fullName', 'revenue': {'$round': ['$count', 2]}, 'Office Location': 'officeLocation'}}]
2022-11-07 16:39:02,429 [MainProcess] [root] [INFO] Pipeline used on Collection: payment
2022-11-07 16:39:02,458 [MainProcess] [root] [INFO] Aggregation returned:
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] {'Full Name': 'Eleanor Hunt', 'revenue': 211.55, 'Office Location': 'officeLocation'}
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] {'Full Name': 'Karl Seal', 'revenue': 208.58, 'Office Location': 'officeLocation'}
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] {'Full Name': 'Marion Snyder', 'revenue': 194.61, 'Office Location': 'officeLocation'}
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] {'Full Name': 'Rhonda Kennedy', 'revenue': 191.62, 'Office Location': 'officeLocation'}
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] {'Full Name': 'Clara Shaw', 'revenue': 189.6, 'Office Location': 'officeLocation'}
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] {'Full Name': 'Tommy Collazo', 'revenue': 183.63, 'Office Location': 'officeLocation'}
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] {'Full Name': 'Ana Bradley', 'revenue': 167.67, 'Office Location': 'officeLocation'}
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] {'Full Name': 'Curtis Irby', 'revenue': 167.62, 'Office Location': 'officeLocation'}
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] {'Full Name': 'Marcia Dean', 'revenue': 166.61, 'Office Location': 'officeLocation'}
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] {'Full Name': 'Mike Way', 'revenue': 162.67, 'Office Location': 'officeLocation'}
2022-11-07 16:39:02,459 [MainProcess] [root] [INFO] 
